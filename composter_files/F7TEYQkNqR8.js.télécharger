;/*FB_PKG_DELIM*/

__d("LSInsertAdminMessageInClientMessages.nop",["FBLogger","I64","MAWBridgeFireAndForget","MAWEphemeralMsgAutoResetSystemId","MAWExternalId","MAWJids","MAWMiActOnActThreadReady","MAWMpsGating","Promise","WAStanzaUtils","WATimeUtils","asyncToGeneratorRuntime","base64Binary","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,l,m,n,o,p){d("MAWMpsGating").isMpsEnabled()&&(o!=null&&p!=null&&(yield d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("mps","mpsHandleLsAdminMessage",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:o,protobuf:d("base64Binary").decode(p).buffer,timestampMs:i.to_float(m)});return(h||(h=b("Promise"))).resolve()})));if(d("MAWMpsGating").isFullMpsEnabled())return(h||(h=b("Promise"))).resolve();var q=o!=null?d("WAStanzaUtils").toStanzaId(o):d("MAWExternalId").generateExternalId();if(l==="change_thread_theme"){var r=n.has("theme_emoji")?j(n.get("theme_emoji")):void 0,s=n.has("theme_name_with_subtitle")?j(n.get("theme_name_with_subtitle")):void 0;if(s==null){c("FBLogger")("messenger_web").mustfix("invalid themeNameWithSubtitle when writing admin message for thread theme customization");return(h||(h=b("Promise"))).resolve()}var t=n.has("theme_type")?j(n.get("theme_type")):void 0;t==null&&c("FBLogger")("messenger_web").warn("invalid themeType when writing admin message for thread theme customization");return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadThemeCustomization",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m)),themeEmoji:r,themeNameWithSubtitle:s,themeType:t});return(h||(h=b("Promise"))).resolve()})}else if(l==="change_thread_image")return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadPhotoCustomization",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m))});return(h||(h=b("Promise"))).resolve()});else if(l==="link_cta"){var u=n.has("initiator_user_id")?j(n.get("initiator_user_id")):void 0;if(u==null){c("FBLogger")("messenger_web").mustfix("UK OSA Link CTA should have valid initiator user id with the message.");return(h||(h=b("Promise"))).resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,e){c("gkx")("9653")&&d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForUKOSA",{actorFbid:u,chatJid:e,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime((i||(i=d("I64"))).to_float(m))});return(h||(h=b("Promise"))).resolve()})}else if(l==="pin_messages_v2")return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForPinMessage",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m))});return(h||(h=b("Promise"))).resolve()});else if(l==="unpin_messages_v2")return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForUnpinMessage",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m))});return(h||(h=b("Promise"))).resolve()});else if(l==="change_thread_icon"){var v=n.has("thread_icon")?j(n.get("thread_icon")):void 0;if(v==null){c("FBLogger")("messenger_web").mustfix("invalid thread_icon when writing admin message for thread hotlike customization");return(h||(h=b("Promise"))).resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadHotlikeCustomization",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m)),threadIcon:v.length===0?"\ud83d\udc4d":v});return(h||(h=b("Promise"))).resolve()})}else if(l==="change_thread_quick_reaction"){var w=n.has("thread_quick_reaction_emoji")?j(n.get("thread_quick_reaction_emoji")):void 0;if(w==null){c("FBLogger")("messenger_web").mustfix("invalid reaction when writing admin message for thread quick reaction customization");return(h||(h=b("Promise"))).resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadHotlikeCustomization",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m)),threadIcon:w.length===0?"\ud83d\udc4d":w});return(h||(h=b("Promise"))).resolve()})}else if(l==="change_thread_nickname"){var x=n.has("participant_id")?j(n.get("participant_id")):void 0,y=n.has("nickname")?j(n.get("nickname")):void 0;if(x==null||y==null){c("FBLogger")("messenger_web").mustfix("invalid params when writing admin message for thread nickname customization");return(h||(h=b("Promise"))).resolve()}return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,c){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForThreadNicknameCustomization",{actorFbid:(i||(i=d("I64"))).to_string(g),chatJid:c,externalId:q,nickName:y,participantId:x,serverAuthoritativeTimestampMs:d("WATimeUtils").castToMillisTime(i.to_float(m))});return(h||(h=b("Promise"))).resolve()})}else if(l==="change_disappearing_setting")return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSInsertAdminMessageInClientMessages_"+l,function(a,e){a=n.has("disappearing_setting_time")?j(n.get("disappearing_setting_time")):void 0;var f=n.has("old_disappearing_setting_time")?j(n.get("old_disappearing_setting_time")):void 0,g=n.has("disappearing_setting_actor_fbid")?j(n.get("disappearing_setting_actor_fbid")):void 0,l=n.has("disappearing_setting_is_initial_sync")?k(n.get("disappearing_setting_is_initial_sync"))===!0:!1;a==null&&c("FBLogger")("messenger_web").mustfix("[labyrinth][web] settingsTtl missing for admin msg, isInitSync: %s",l.toString());var o=g===c("MAWEphemeralMsgAutoResetSystemId"),p=parseInt(a,10);g==null&&l&&c("FBLogger")("messenger_web").info("[labyrinth][web] author for ephemeral admin msg is null, ttl is zero: %s",(p===0).toString());if(l)return(h||(h=b("Promise"))).resolve();if(l||o){d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForEphemeralSettingsChange",{author:null,chatJid:e,expirationInSec:p,externalId:q,isEphemeralSettingReset:o,isInitSync:l,isTurningOnEphemeralSetting:l,serverTs:d("WATimeUtils").castToUnixTime((i||(i=d("I64"))).to_float(m)/1e3)});return(h||(h=b("Promise"))).resolve()}else g!=null&&a!=null?d("MAWBridgeFireAndForget").fireAndForget("backend","writeAdminMessageForEphemeralSettingsChange",{author:d("MAWJids").toUserJid(g),chatJid:e,expirationInSec:p,externalId:q,isEphemeralSettingReset:!1,isInitSync:!1,isTurningOnEphemeralSetting:f==null||f==="0",serverTs:d("WATimeUtils").castToUnixTime((i||(i=d("I64"))).to_float(m)/1e3)}):c("FBLogger")("messenger_web").mustfix("[labyrinth][web] param missing for admin msg, author: %s, settingsTtl: %s, oldSettingsTtl: %s, isInitSync: %s",(g!=null).toString(),(a!=null).toString(),(f!=null).toString(),l.toString());return(h||(h=b("Promise"))).resolve()});return(h||(h=b("Promise"))).resolve()});function e(b,c,d,e,f,g,h,i,j){return a.apply(this,arguments)}return e}();var j=function(a){if(a==null)return void 0;if(typeof a==="string")return a;c("FBLogger")("messenger_web").mustfix("Invalid type for string, expected string, but got %s",typeof a);return void 0},k=function(a){if(typeof a==="boolean")return a;c("FBLogger")("messenger_web").mustfix("Invalid type for boolean, expected boolean, but got %s",typeof a);return void 0};a.__nop_name__="LSInsertAdminMessageInClientMessages";g["default"]=a}),98);
__d("LSInsertAdminMessageInClientMessages",["LSInsertAdminMessageInClientMessages.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSInsertAdminMessageInClientMessages.nop"),a[0],a[1],a[2],a[3],a[4],a[5],a[6])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxInsertAdminMessageInClientMessagesStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateDisappearingSettingInClientThreadsTable.nop",["I64","LSMessagingThreadAttributionType","MAWBridgeFireAndForget","MAWBridgeSendAndReceive","MAWCurrentUser","MAWEphemeralMsgAutoResetSystemId","MAWJids","MAWMessageSendReporter","MAWMessageSendReporterV2","MAWMiActOnActThreadReady","Promise","ReQL","WATimeUtils","asyncToGeneratorRuntime","promiseDone","qpl","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(f)));if(g!=null)return d("MAWMiActOnActThreadReady").onActThreadReady(a,f,"LSUpdateDisappearingSettingInClientThreadsTable.nop",function(a,e){var f={ephemeralExpirationInSec:(i||(i=d("I64"))).to_int32((a=g.disappearingSettingTtl)!=null?a:(i||(i=d("I64"))).zero),ephemeralLastUpdatedOrSetTimestamp:d("WATimeUtils").castMilliSecondsToUnixTime(i.to_float((a=g.disappearingSettingUpdatedTs)!=null?a:(i||(i=d("I64"))).zero))};d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingCache",{jid:e,settings:f});if(g.disappearingSettingUpdatedBy!=null){a=(i||(i=d("I64"))).to_string(g.disappearingSettingUpdatedBy);var j=a===c("MAWEphemeralMsgAutoResetSystemId");if(a===d("MAWCurrentUser").getID()||j){var k=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","setEphemeralSettingsFromFrontend",{chatJid:e,ephemeralExpirationInSec:f.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:f.ephemeralLastUpdatedOrSetTimestamp,isEphemeralSettingReset:j,s2sInstanceKey:a})};if(d("MAWMessageSendReporterV2").isMessageSendReporterV2Enabled())c("promiseDone")(d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"LSUpdateDisappearingSetting",lsSource:"unknown",messageTypeParamsArgs:{isEphemeralSetting:!0},thread:g},function(a){return k(a).then(function(a){return[a]})}));else{var l=d("sendToSentQPLLogger").markSendToSentStartWithAnnotation(g,{isEphemeralSetting:!0},c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWMessageSendReporter").MAWMessageSendReporter(null,k(l),{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:l}))}}else d("MAWBridgeFireAndForget").fireAndForget("backend","setEphemeralSettingsFromMI",{author:d("MAWJids").toUserJid(a),chatJid:e,ephemeralExpirationInSec:f.ephemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:f.ephemeralLastUpdatedOrSetTimestamp,fromWAI:!1,isEphemeralSettingReset:!1,serverTs:f.ephemeralLastUpdatedOrSetTimestamp})}return(h||(h=b("Promise"))).resolve()})});function e(b,c,d){return a.apply(this,arguments)}return e}();a.__nop_name__="LSInsertAdminMessageInClientMessages";g["default"]=a}),98);
__d("LSUpdateDisappearingSettingInClientThreadsTable",["LSUpdateDisappearingSettingInClientThreadsTable.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.nativeOperation(b("LSUpdateDisappearingSettingInClientThreadsTable.nop"),a[0])},function(a){return c.resolve(d)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateDisappearingSettingInClientThreadsTableStoredProcedure";a.__tables__=[];e.exports=a}),null);